{% extends "base.html" %}
{% block title %}Scan Result{% endblock %}

{% block content %}
<div class="card" style="max-width:800px;margin:auto">

    <h2 class="h-xxl">Scan Result</h2>

    <p><strong>URL:</strong> <span class="mono">{{ url }}</span></p>

    {% if result == 'phishing' %}
        <p class="h-lg" style="color:var(--danger)">⚠️ Phishing Detected</p>
    {% else %}
        <p class="h-lg" style="color:var(--success)">✔️ Likely Safe</p>
    {% endif %}

    {% if prob %}
    <p><strong>Model Confidence:</strong> {{ (prob * 100) | round(1) }}%</p>
    {% endif %}

    <!-- PIE CHART CARD -->
    <div class="card" style="margin-top:18px">
        <h3 class="h-lg">Risk Distribution</h3>
        <canvas id="pieChart" style="width:100%; max-height:320px;"></canvas>
    </div>

    <div style="margin-top:16px">
        <a class="btn btn-primary" href="{{ url_for('dashboard') }}">Scan another</a>
       
    </div>

</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const phishingProb = {{ prob if prob else 0.70 }};
    const safeProb = 1 - phishingProb;

    new Chart(document.getElementById('pieChart'), {
        type: 'pie',
        data: {
            labels: ["Phishing Probability", "Safe Probability"],
            datasets: [{
                data: [phishingProb * 100, safeProb * 100],
                backgroundColor: [
                    "rgba(255, 0, 51, 0.8)",      // red
                    "rgba(0, 214, 143, 0.85)"     // green
                ],
                borderColor: [
                    "rgba(255, 0, 51, 1)",
                    "rgba(0, 214, 143, 1)"
                ],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            animation: {
                animateScale: true
            },
            plugins: {
                legend: {
                    labels: {
                        color: "#fff",
                        font: { size: 14 }
                    }
                }
            }
        }
    });
</script>

{% endblock %}
